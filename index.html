<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bookmark</title>
  <meta name="theme-color" content="#111" />
  <!-- Use a separate manifest for true standalone install (no Chrome badge) -->
  <link rel="manifest" href="manifest.json" />
  <style>
    :root{
      --bg:#ffffff; --fg:#111111; --muted:#666; --accent:#111; --accent-fg:#fff; --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:18px; --card-bg:#fff; --border:#e6e6e6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color:var(--fg); background:var(--bg);}
    .container{max-width:720px;margin:0 auto;padding:28px 20px 90px;}
    header{position:sticky;top:0;background:linear-gradient(#fff 75%, rgba(255,255,255,.85));backdrop-filter:saturate(180%) blur(6px);z-index:2;display:flex;align-items:center;justify-content:space-between;}
h1{font-size:44px;margin:8px 0 16px;font-weight:800;letter-spacing:.3px}

.group{margin:22px 0 14px}
.group h2{font-size:24px;margin:18px 2px 10px;font-weight:800}
.list{display:grid;gap:10px}

.item{display:flex;align-items:center;gap:10px}
.item a.title{display:inline-flex;align-items:center;gap:10px; padding:10px 14px; border:1.5px solid var(--border); border-radius:14px; text-decoration:none; color:var(--fg); background:var(--card-bg); box-shadow: var(--shadow);}
.item a.title:hover{transform:translateY(-1px); box-shadow:0 14px 30px rgba(0,0,0,.10)}

.chip{appearance:none;border:none;background:#222;color:#fff;border-radius:999px;padding:6px 10px;font-weight:800;font-size:12px;cursor:pointer}
.chip.ghost{background:#444}

/* Empty state */
.empty{margin:28vh 0 0; text-align:center; color:var(--muted)}
.empty .hint{margin-top:10px}

/* FAB */
.fab{position:fixed; right:22px; bottom:22px; width:64px; height:64px; border-radius:50%; border:2px solid var(--fg); display:grid; place-items:center; background:var(--card-bg); box-shadow:0 10px 30px rgba(0,0,0,.18); cursor:pointer; z-index:3}
.fab:active{transform:translateY(1px)}
.plus{width:28px;height:28px;position:relative}
.plus::before,.plus::after{content:""; position:absolute; inset:0; margin:auto; background:var(--fg); border-radius:2px}
.plus::before{width:4px; height:28px}
.plus::after{width:28px; height:4px}

/* Modal */
dialog{border:none; border-radius:24px; padding:0; width:min(92vw, 520px); box-shadow:0 30px 80px rgba(0,0,0,.25); background:var(--card-bg); color:var(--fg)}
dialog::backdrop{background:rgba(0,0,0,.25)}
.modal{padding:22px}
.modal h3{margin:0 0 14px; font-size:26px}
.field{margin:14px 0}
label{display:block; font-weight:700; margin:0 0 8px}
input, select{width:100%; padding:12px 14px; border-radius:14px; border:1.5px solid #d9d9d9; background:#fafafa; font:inherit}
.row{display:flex; gap:12px; flex-wrap:wrap; margin-top:18px}
.btn{appearance:none; border:none; padding:12px 16px; border-radius:14px; font-weight:800; cursor:pointer}
.btn.primary{background:var(--accent); color:var(--accent-fg)}
.btn.ghost{background:#eee; color:#111}

.mutelink{font-size:14px; color:var(--muted); text-decoration:underline; cursor:pointer}

@media (max-width:420px){
  h1{font-size:38px}
  .fab{right:16px; bottom:16px}
}

    #settingsBtn{appearance:none;border:none;background:transparent;cursor:pointer;font-size:24px;color:var(--fg);}
    html.dark{--bg:#111111; --fg:#ffffff; --muted:#aaa; --accent:#ffffff; --accent-fg:#111111; --shadow:0 10px 30px rgba(0,0,0,.5); --card-bg:#1e1e1e; --border:#444444;}
    html.dark header{background:linear-gradient(#111 75%, rgba(17,17,17,.85));}
  </style>
</head>
<body>
  <div class="container">
    <header><h1>Bookmark</h1><button id="settingsBtn" aria-label="Settings">üéõÔ∏è</button></header>
    <main id="root"></main>
    <p class="empty" id="emptyState" hidden>
      Nothing here yet.<br>
      <span class="hint">Tap the <strong>+</strong> to add your first link.</span>
    </p>
  </div><button class="fab" id="fab" aria-label="Add link"><span class="plus" aria-hidden="true"></span></button>

  <!-- Add / Edit Link Modal -->  <dialog id="linkDlg">
    <form method="dialog" class="modal" id="linkForm">
      <h3 id="linkDlgTitle">Add Link</h3>
      <div class="field">
        <label for="groupSelect">Group</label>
        <div style="display:flex; gap:8px; align-items:center">
          <select id="groupSelect" required></select>
          <button class="btn ghost" id="manageGroupsBtn" type="button" title="Manage groups">Manage</button>
        </div>
      </div>
      <div class="field">
        <label for="titleInput">Display Text</label>
        <input id="titleInput" placeholder="e.g., Task List" required />
      </div>
      <div class="field">
        <label for="urlInput">Link</label>
        <input id="urlInput" placeholder="https://‚Ä¶" inputmode="url" required />
      </div>
      <div class="row">
        <button class="btn primary" value="save">Save</button>
        <button class="btn ghost" value="cancel">Cancel</button>
      </div>
    </form>
  </dialog>  <!-- Group Manager Modal -->  <dialog id="groupDlg">
    <form method="dialog" class="modal" id="groupForm">
      <h3>Groups</h3>
      <div id="groupList" class="list" style="margin:8px 0 14px"></div>
      <div class="field">
        <label for="newGroup">New Group</label>
        <input id="newGroup" placeholder="e.g., Personal" />
      </div>
      <div class="row">
        <button class="btn primary" value="add">Add</button>
        <button class="btn ghost" value="close">Close</button>
      </div>
      <p class="mutelink" id="resetDemo" style="margin-top:10px" title="Reset data">Reset (clear all)</p>
    </form>
  </dialog>  <!-- Settings Modal -->  <dialog id="settingsDlg">
    <form method="dialog" class="modal" id="settingsForm">
      <h3>Settings</h3>
      <div class="field">
        <button class="btn primary" id="exportBtn" type="button">Export Data</button>
      </div>
      <div class="field">
        <label for="importInput">Import Data</label>
        <input id="importInput" type="file" accept="application/json" />
      </div>
      <div class="field" id="passcodeField">
        <label for="pass1">Passcode</label>
        <input type="password" pattern="\d{6}" id="pass1" placeholder="6-digit passcode" />
        <input type="password" pattern="\d{6}" id="pass2" placeholder="Confirm" style="margin-top:8px" />
        <div class="row">
          <button class="btn primary" id="savePasscodeBtn" type="button">Save Passcode</button>
          <button class="btn ghost" id="removePasscodeBtn" type="button" hidden>Remove Passcode</button>
        </div>
      </div>
      <div class="field">
        <button class="btn ghost" id="modeToggle" type="button">Dark Mode</button>
      </div>
      <div class="field">
        <button class="btn primary" id="updateBtn" type="button">Update Bookmark</button>
      </div>
      <div class="field">
        <button class="btn ghost" id="wipeBtn" type="button">Wipe Data</button>
      </div>
      <div class="row">
        <button class="btn ghost" value="close">Close</button>
      </div>
    </form>
  </dialog>  <!-- Passcode Dialog -->  <dialog id="passcodeDlg">
    <form method="dialog" class="modal" id="passcodeForm">
      <h3>Enter Passcode</h3>
      <div class="field">
        <label for="passcodeInput">Passcode</label>
        <input type="password" pattern="\d{6}" id="passcodeInput" />
      </div>
      <p class="mutelink" id="passErr" hidden style="color:red">Incorrect passcode</p>
      <div class="row">
        <button class="btn primary" value="ok">Unlock</button>
        <button class="btn ghost" value="cancel">Cancel</button>
      </div>
    </form>
  </dialog>  <!-- Info Modal -->  <dialog id="infoDlg">
    <form method="dialog" class="modal">
      <p id="infoMsg" style="margin:14px 0"></p>
      <div class="row">
        <button class="btn primary" value="ok">OK</button>
      </div>
    </form>
  </dialog>  <!-- Confirm Modal -->  <dialog id="confirmDlg">
    <form method="dialog" class="modal">
      <p id="confirmMsg" style="margin:14px 0"></p>
      <div class="row">
        <button class="btn primary" value="ok">Delete</button>
        <button class="btn ghost" value="cancel">Cancel</button>
      </div>
    </form>
  </dialog>  <script>
  // -------- Data Layer (localStorage) --------
  const STORE_KEY = 'hubData.v1';
  const THEME_KEY = 'hubTheme';
  const PASS_KEY = 'hubPass';
  const load = () => JSON.parse(localStorage.getItem(STORE_KEY) || '{"groups":["Personal"],"items":[]}');
  const save = (data) => localStorage.setItem(STORE_KEY, JSON.stringify(data));
  const state = load();
  const hashPass = async(p)=>{
    const buf = new TextEncoder().encode(p);
    const digest = await crypto.subtle.digest('SHA-256', buf);
    return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,'0')).join('');
  };
  const setPasscode = async(p)=>{
    const h = await hashPass(p); localStorage.setItem(PASS_KEY, h);
  };
  const clearPasscode = ()=> localStorage.removeItem(PASS_KEY);
  const verifyPasscode = async(p)=>{
    const h = await hashPass(p); return h === localStorage.getItem(PASS_KEY);
  };

  // --------- UI Refs ---------
  const root = document.getElementById('root');
  const emptyState = document.getElementById('emptyState');
  const linkDlg = document.getElementById('linkDlg');
  const linkForm = document.getElementById('linkForm');
  const linkDlgTitle = document.getElementById('linkDlgTitle');
  const groupDlg = document.getElementById('groupDlg');
  const groupForm = document.getElementById('groupForm');
  const groupList = document.getElementById('groupList');
  const fab = document.getElementById('fab');
  const settingsBtn = document.getElementById('settingsBtn');
  const settingsDlg = document.getElementById('settingsDlg');
  const exportBtn = document.getElementById('exportBtn');
  const importInput = document.getElementById('importInput');
  const modeToggle = document.getElementById('modeToggle');
  const updateBtn = document.getElementById('updateBtn');
  const wipeBtn = document.getElementById('wipeBtn');
  const pass1 = document.getElementById('pass1');
  const pass2 = document.getElementById('pass2');
  const savePasscodeBtn = document.getElementById('savePasscodeBtn');
  const removePasscodeBtn = document.getElementById('removePasscodeBtn');
  const passcodeDlg = document.getElementById('passcodeDlg');
  const passcodeForm = document.getElementById('passcodeForm');
  const passcodeInput = document.getElementById('passcodeInput');
  const passErr = document.getElementById('passErr');
  const infoDlg = document.getElementById('infoDlg');
  const infoMsg = document.getElementById('infoMsg');
  const confirmDlg = document.getElementById('confirmDlg');
  const confirmMsg = document.getElementById('confirmMsg');
  const appContainer = document.querySelector('.container');

  const groupSelect = document.getElementById('groupSelect');
  const titleInput = document.getElementById('titleInput');
  const urlInput = document.getElementById('urlInput');
  const manageGroupsBtn = document.getElementById('manageGroupsBtn');

  const resetDemo = document.getElementById('resetDemo');

  let editingId = null;
  let unlocked = true;
  let passAttempts = 0;
  const passHash = localStorage.getItem(PASS_KEY);
  if(passHash){
    unlocked = false;
    appContainer.style.display='none';
    fab.style.display='none';
    exportBtn.disabled = true;
    passcodeDlg.showModal();
  }
  function unlock(){
    unlocked = true;
    appContainer.style.display='';
    fab.style.display='';
    exportBtn.disabled = false;
    render();
  }
  function applyTheme(){
    const theme = localStorage.getItem(THEME_KEY) || 'light';
    document.documentElement.classList.toggle('dark', theme === 'dark');
    modeToggle.textContent = theme === 'dark' ? 'Lite Mode' : 'Dark Mode';
  }

  function ensureProtocol(u){
    try{ const hasProtocol = /^(https?:)?\/\//i.test(u); return hasProtocol ? u : 'https://' + u; }catch{ return u }
  }

  function showInfo(msg){
    infoMsg.textContent = msg;
    infoDlg.showModal();
  }

  function confirmAction(msg){
    confirmMsg.textContent = msg;
    confirmDlg.returnValue = 'cancel';
    confirmDlg.showModal();
    return new Promise(resolve=>{
      confirmDlg.addEventListener('close', function handler(){
        resolve(confirmDlg.returnValue === 'ok');
        confirmDlg.removeEventListener('close', handler);
      }, {once:true});
    });
  }

  function renderGroupsSelect(){
    groupSelect.innerHTML = '';
    state.groups.forEach(g=>{
      const opt = document.createElement('option');
      opt.value = g; opt.textContent = g; groupSelect.appendChild(opt);
    });
  }

  function renderGroupListManager(){
    groupList.innerHTML = '';
    if(!state.groups.length){ state.groups.push('General'); }
    state.groups.forEach((g,i)=>{
      const row = document.createElement('div');
      row.className = 'item';
      row.style.gap='8px';
      const badge = document.createElement('a');
      badge.textContent = g; badge.href = '#'; badge.onclick=(e)=>e.preventDefault();
      badge.style.borderRadius='999px';
      badge.style.padding='8px 12px';
      badge.style.border='1.5px solid #e6e6e6';
      badge.style.fontWeight='700';
      badge.style.textDecoration='none';
      badge.style.color='#fff';
      row.appendChild(badge);

      const edit = document.createElement('button');
      edit.className='btn ghost'; edit.textContent='Edit';
      edit.onclick = (e)=>{ e.preventDefault();
        const newName = prompt('Rename group', g)?.trim();
        if(!newName || newName===g) return;
        if(state.groups.includes(newName)){ alert('Group name already exists'); return; }
        state.groups[i] = newName;
        state.items.forEach(it=>{ if(it.group===g) it.group = newName; });
        save(state); render(); renderGroupListManager(); renderGroupsSelect();
      };
      row.appendChild(edit);

      if(state.groups.length>1){
        const del = document.createElement('button');
        del.className='btn ghost'; del.textContent='Delete';
        del.onclick = async (e)=>{ e.preventDefault();
          const used = state.items.some(it=>it.group===g);
          if(used){ alert('Remove or reassign links in this group first.'); return; }
          if(await confirmAction('Delete this group?')){
            state.groups.splice(i,1); save(state); render(); renderGroupListManager(); renderGroupsSelect();
          }
        };
        row.appendChild(del);
      }

      groupList.appendChild(row);
    });
  }

  function render(){
    root.innerHTML = '';
    const groupsWithItems = new Set([...state.groups, ...state.items.map(i=>i.group)]);

    emptyState.hidden = state.items.length!==0;

    [...groupsWithItems].forEach(groupName=>{
      const section = document.createElement('section');
      section.className='group';
      const h2 = document.createElement('h2'); h2.textContent = groupName; section.appendChild(h2);
      const list = document.createElement('div'); list.className='list';

      state.items.filter(i=>i.group===groupName).forEach(i=>{
        const row = document.createElement('div'); row.className='item';

        // Display Text as a link ONLY
        const a = document.createElement('a');
        a.className='title'; a.textContent = i.title; a.href=i.url; a.target='_blank'; a.rel='noopener noreferrer';
        row.appendChild(a);

        // Edit & Delete chips
        const editBtn = document.createElement('button'); editBtn.className='chip'; editBtn.textContent='Edit';
        editBtn.onclick = ()=>{
          editingId = i.id;
          renderGroupsSelect();
          groupSelect.value = i.group;
          titleInput.value = i.title; urlInput.value = i.url;
          linkDlgTitle.textContent = 'Edit Link';
          linkDlg.showModal();
        };
        row.appendChild(editBtn);

        const delBtn = document.createElement('button'); delBtn.className='chip ghost'; delBtn.textContent='Delete';
        delBtn.onclick = async ()=>{
          if(await confirmAction('Delete this link?')){
            const idx = state.items.findIndex(x=>x.id===i.id);
            if(idx>-1){ state.items.splice(idx,1); save(state); render(); }
          }
        };
        row.appendChild(delBtn);

        list.appendChild(row);
      });

      section.appendChild(list); root.appendChild(section);
    });
  }

  // ----- Events -----
  fab.addEventListener('click', ()=>{
    renderGroupsSelect();
    editingId = null;
    linkDlgTitle.textContent = 'Add Link';
    titleInput.value=''; urlInput.value='';
    linkDlg.showModal();
  });

  settingsBtn.addEventListener('click', ()=>{ removePasscodeBtn.hidden = !localStorage.getItem(PASS_KEY); settingsDlg.showModal(); });

  exportBtn.addEventListener('click', ()=>{
    if(!unlocked) return;
    const blob = new Blob([JSON.stringify(state)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'hub-data.json'; a.click();
    URL.revokeObjectURL(url);
  });

  savePasscodeBtn.addEventListener('click', async ()=>{
    const p1 = pass1.value.trim();
    const p2 = pass2.value.trim();
    if(p1!==p2){ showInfo('Passcodes must match'); return; }
    if(!/^\d{6}$/.test(p1)){ showInfo('Passcode must be exactly six digits'); return; }
    await setPasscode(p1);
    pass1.value = pass2.value = '';
    removePasscodeBtn.hidden = false;
    showInfo('Passcode saved');
  });

  removePasscodeBtn.addEventListener('click', ()=>{
    clearPasscode();
    removePasscodeBtn.hidden = true;
    showInfo('Passcode removed');
  });

  updateBtn.addEventListener('click', async ()=>{
    settingsDlg.close();
    if('caches' in window){
      const keys = await caches.keys();
      await Promise.all(keys.map(k=>caches.delete(k)));
    }
    if('serviceWorker' in navigator){
      const regs = await navigator.serviceWorker.getRegistrations();
      await Promise.all(regs.map(r=>r.update()));
    }
    location.reload();
  });

  wipeBtn.addEventListener('click', ()=>{
    if(confirm('Clear all Hub data?')){
      localStorage.removeItem(STORE_KEY);
      localStorage.removeItem(PASS_KEY);
      localStorage.removeItem(THEME_KEY);
      removePasscodeBtn.hidden = true;
      pass1.value = pass2.value = '';
      settingsDlg.close();
      Object.assign(state, load());
      render();
      renderGroupsSelect();
      applyTheme();
      showInfo('Data wiped');
    }
  });

  passcodeForm.addEventListener('submit', async (e)=>{
    const action = e.submitter?.value; if(action!=='ok') return;
    e.preventDefault();
    const pwd = passcodeInput.value.trim();
    if(await verifyPasscode(pwd)){
      passErr.hidden = true;
      passcodeInput.value='';
      passcodeDlg.close();
      unlock();
    }else{
      passErr.hidden = false;
      passcodeInput.value='';
      passAttempts++; if(passAttempts>=3){ passErr.textContent='Too many attempts'; passcodeInput.disabled=true; }
    }
  });

  passcodeDlg.addEventListener('close', ()=>{ if(!unlocked) passcodeDlg.showModal(); });

  importInput.addEventListener('change', (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const data = JSON.parse(reader.result);
        if(data && Array.isArray(data.groups) && Array.isArray(data.items)){
          localStorage.setItem(STORE_KEY, JSON.stringify(data));
          Object.assign(state, data); render();
        }else{ alert('Invalid data'); }
      }catch{ alert('Invalid data'); }
    };
    reader.readAsText(file);
    e.target.value='';
  });

  modeToggle.addEventListener('click', ()=>{
    const theme = localStorage.getItem(THEME_KEY) === 'dark' ? 'light' : 'dark';
    localStorage.setItem(THEME_KEY, theme); applyTheme();
  });

  manageGroupsBtn.addEventListener('click', ()=>{ renderGroupListManager(); groupDlg.showModal(); });

  groupForm.addEventListener('close', ()=>{ renderGroupsSelect(); });
  groupForm.addEventListener('submit', (e)=>{
    const action = e.submitter?.value; // add / close
    if(action==='add'){
      e.preventDefault();
      const name = document.getElementById('newGroup').value.trim();
      if(!name) return;
      if(!state.groups.includes(name)) state.groups.push(name);
      document.getElementById('newGroup').value=''; save(state); render(); renderGroupListManager(); renderGroupsSelect();
    }
  });

  linkForm.addEventListener('submit', (e)=>{
    const action = e.submitter?.value; if(action!=='save') return; e.preventDefault();
    const group = groupSelect.value.trim();
    const title = titleInput.value.trim();
    let url = ensureProtocol(urlInput.value.trim());
    if(!group || !title || !url) return;
    if(!state.groups.includes(group)) state.groups.push(group);

    if(editingId){
      const item = state.items.find(x=>x.id===editingId);
      if(item){ item.group = group; item.title = title; item.url = url; }
    }else{
      state.items.push({ id: Date.now(), group, title, url });
    }

    save(state); render(); linkDlg.close();
  });

  linkDlg.addEventListener('close', ()=>{ editingId=null; });

  resetDemo.addEventListener('click', ()=>{ if(confirm('Clear all groups and links?')){ localStorage.removeItem(STORE_KEY); Object.assign(state, load()); render(); renderGroupsSelect(); } });

  // initial UI
  if(unlocked) render();
  applyTheme();

  // ---------- Register external service worker for proper PWA install ----------
  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=>{
      navigator.serviceWorker.register('sw.js');
    });
  }
  </script>
</body>
</html>
